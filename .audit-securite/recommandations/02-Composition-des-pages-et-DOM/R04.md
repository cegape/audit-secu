# R4 — Utiliser l'API DOM à bon escient

**Explication** : L'utilisation de l'API DOM doit se faire avec précaution. Les méthodes qui interprètent du HTML (`innerHTML`, `outerHTML`, `document.write()`, `insertAdjacentHTML()`) doivent être évitées au profit de méthodes sûres (`textContent`, `createElement`, `appendChild`). L'injection de contenu non échappé dans le DOM ouvre la porte aux attaques XSS.

**Statut** : ❌ Non conforme
**Vérification** : Effectuée le 2026-02-09

**Constat** : 90 occurrences de méthodes DOM dangereuses dans le code applicatif (hors librairies tierces). Détail : **87 innerHTML** (dont 56 avec des données provenant de réponses AJAX injectées directement — `contenuHtml.innerHTML = data.message` / `xhr.responseText`), **3 document.write** (popup logs d'import), 0 outerHTML, 0 insertAdjacentHTML. Aucune sanitisation côté client visible (pas de DOMPurify). Le risque XSS dépend de la qualité de l'échappement serveur.

**Preuves/Fichiers** :
- `grails-app/assets/javascripts/administration/paramParticuliers/paramsArrete.js:109,199` — innerHTML = xhr.responseText
- `grails-app/assets/javascripts/gestionpersonnel/individus/ficheindividu/infosperso/psc/ayantDroit/functions.js:150` — innerHTML = jqXHR.responseText
- `grails-app/assets/javascripts/gestionpersonnel/individus/gestionCollective/functions.js` — 12+ occurrences innerHTML avec data serveur
- `grails-app/assets/javascripts/administration/structures/functions.js:505` — document.write dans popup
- 87 fichiers JS applicatifs touchés au total (voir rapport détaillé)
